<template>

    <v-data-table :headers="headers" :items="tickets" item-key="name"   >
      
      <template v-slot:top>
        <v-container>
          <v-row>
            <v-col cols="6">
              <v-row>
                <v-text-field  v-model="nameFilterValue" clearable type="text" label="Name"></v-text-field>
              </v-row>
              <v-row>
                <v-select :items="status" clearable v-model="statusFilterValue" label="Status"></v-select>
              </v-row>
            </v-col>
            <v-col cols="6">
              <v-row>
                <v-select :items="Agents" clearable v-model="agentFilterValue" label="Agent"></v-select>
              </v-row>
              <v-row>
                <v-select :items="Companies" clearable v-model="companyFilterValue" label="Company"></v-select>
              </v-row>
            </v-col>
          </v-row>
        </v-container>
      </template>
    </v-data-table>
</template>

<script>
import axios from "axios";

export default {
  data() {
    return {
      status: [
        { text: "All", value: null },
        { text: "Open", value: "Open" },
        { text: "Closed", value: "Closed" }
      ],
      Agents: [
        { text: "All", value: null },
        { text: "Roger", value: "Roger" },
        { text: "Hugo", value: "Hugo" },
        { text: "John fucking Doe", value: "John" }
      ],
      Companies: [
        { text: "All", value: null },
        { text: "Contoso", value: "Contoso" },
        { text: "Google", value: "Google" }
      ],
      nameFilterValue: "",
      caloriesFilterValue: null,
      statusFilterValue: null,
      agentFilterValue: null,
      companyFilterValue: null,

      tickets: []
    };
  },
  computed: {
    headers() {
      return [
        {
          text: "Title",
          align: "left",
          sortable: false,
          value: "title",
          filter: this.nameFilter
        },
        {
          text: "Calories",
          value: "status.name",
          filter: this.caloriesFilter
        },
        { text: "Id", value: "id" },
        { text: "Status", value: "status.name", filter: this.statusFilter },
        {
          text: "Agent",
          value: "agent.first_name",
          filter: this.agentFilter,
          sortable: true
        },
        { text: "Company", value: "company.name", filter: this.companyFilter }
      ];
    }
  },

  methods: {
    GetTickets() {
      axios
        .get("http://localhost:1338/ticket/all", {
          params: {
            //id: 1
          }
        })
        .then(Response => {
          this.tickets = Response.data;
        })
        .catch(error => {
          console.log(error);
        });
    },
    nameFilter(value) {
      if (!this.nameFilterValue) {
        return true;
      }

      return value
        .toLowerCase()
        .includes(this.nameFilterValue.toLowerCase());
    },

    statusFilter(value) {
      if (!this.statusFilterValue) {
        return true;
      }
      return value === this.statusFilterValue;
    },
    companyFilter(value) {
      if (!this.companyFilterValue) {
        return true;
      }

      return value === this.companyFilterValue;
    },
    agentFilter(value) {
      if (!this.agentFilterValue) {
        return true;
      }

      return value === this.agentFilterValue;
    }
  },
  mounted() {
    this.GetTickets();
  }
};
</script>